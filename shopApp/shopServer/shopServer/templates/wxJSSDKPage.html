<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<title>Document</title>
	</head>

	<body>
		我是界面....

		<button class="startluyin">开始录音</button>
		<button class="stopluyin">停止录音</button>
		<button class="playluyin">播放录音</button>
		<button class="choseImage">选择图片</button>


        <button class="clear">清楚缓存</button>

        <button class="shouquqan">网页授权</button>
		
	</body>

	<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>

	<script type="text/javascript">

        // http%3A%2F%2Fwww.dangsh.top%2FwxjssdkPage%2F


        /*
		alert(location.href.split('#')[0])

        function getQueryString(name) { 
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
            var r = window.location.search.substr(1).match(reg); 
            if (r != null) return unescape(r[2]); 
            return null; 
        } 

        var localUrl = location.href.split('#')[0]
        alert(getQueryString("code"))
        var code = getQueryString("code")

        // $.get("http://www.dangsh.top/getOpenidByCode/?code=" + code , function (data) {
        //     alert(data)
        //     alert(JSON.stringify(data))
        // })

        // $.get("http://www.baidu.com" , function (data) {
        //     alert(data)
        //     alert(JSON.stringify(data))
        // })




        var xmlhttp;
        if (window.XMLHttpRequest)
        {
            //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
            xmlhttp=new XMLHttpRequest();
        }
        else
        {
            // IE6, IE5 浏览器执行代码
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function()
        {
            console.log("lllll")
            if (xmlhttp.readyState==4 && xmlhttp.status==200)
            {
                console.log(xmlhttp.responseText)
                alert(xmlhttp.responseText)
            }
        }
        xmlhttp.open("GET","http://www.dangsh.top/getOpenidByCode/?code=" + code,true);
        xmlhttp.send();

        console.log(xmlhttp)
        */

        /*

		var luyinId = ""


		$(".startluyin").click(function () {
			alert("开始录音")
			wx.startRecord();
		})

		$(".stopluyin").click(function () {
			alert("停止录音")
			wx.stopRecord({
				success: function (res) {
					luyinId = res.localId;
					alert("拿到录音id")
					alert(luyinId)
				} , 
				error: function (err) {
					alert("录音失败")
					alert(err)
				}
			});
		})

		$(".playluyin").click(function () {
			wx.playVoice({
				localId: luyinId // 需要播放的音频的本地ID，由stopRecord接口获得
			});
		})


		$(".choseImage").click(function () {
			alert("从相册中选择图片")
			wx.chooseImage({
				count: 1, // 默认9
				sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
				sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
				success: function (res) {
					alert(JSON.stringify(res))
					var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
				}
			});
		})


        */
// http://www.lb741.com/wxjssdk/

// http://www.lb741.com/yyy


        // 微信 网页授权
        /*
        // var appid = "wx619c085e365678c4"
        // var redirect_uri = "http://www.dangsh.top/getcode/"
        // redirect_uri = encodeURIComponent(redirect_uri)
        // $.get("https://open.weixin.qq.com/connect/oauth2/authorize?appid=" + appid + "&redirect_uri=" + redirect_uri + "&response_type=code&scope=snsapi_userinfo &state=123#wechat_redirect" , function (data) {
        //     alert(JSON.stringify(data))
        // })

        $(".shouquqan").click(function () {
            var appid = "wx619c085e365678c4"
            var redirect_uri = "http://www.dangsh.top/getcode/"
            redirect_uri = encodeURIComponent(redirect_uri)
            var newUrl = "https://open.weixin.qq.com/connect/oauth2/authorize?appid=" + appid + "&redirect_uri=" + redirect_uri + "&response_type=code&scope=snsapi_base&state=123#wechat_redirect"


            window.open(newUrl)
            // window.open("http://www.baidu.com")

            // $.get("https://open.weixin.qq.com/connect/oauth2/authorize?appid=" + appid + "&redirect_uri=" + redirect_uri + "&response_type=code&scope=snsapi_userinfo &state=123#wechat_redirect" , function (data) {
            //     alert(JSON.stringify(data))
            // })
        })


        */


        // /*   微信 JS-SDK
		$.get(
			"http://www.dangsh.top/wxjssdk/", {url: location.href} , 
			function(data){
				alert(JSON.stringify(data))
				console.log("拿到结果了")
				console.log(data)
				wx.config({
					debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
					appId: "wx619c085e365678c4", // 必填，公众号的唯一标识
					timestamp: data.timestamp + "", // 必填，生成签名的时间戳
					nonceStr: data.nonceStr, // 必填，生成签名的随机串
					signature: data.signature,// 必填，签名，见附录1
					jsApiList: ['chooseImage' , 'onMenuShareTimeline' , 'startRecord' , 'stopRecord' , 'playVoice'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
				});


				wx.ready(function () {
					alert("weixinready 了")
					wx.onMenuShareTimeline({
						title: '', // 分享标题
						link: 'http://www.dangsh.top/wxjssdkPage/', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
						imgUrl: 'wode 第一次', // 分享图标
						success: function (confirm) {
							// 用户确认分享后执行的回调函数
							alert("confirm")
						},
						cancel: function (cancel) {
							alert("cancel")
						}
					});
				})
					
				wx.error(function (res) {

                    // 清楚 access_token 和 jsapi_ticket
                    $.get("http://www.dangsh.top/clearAccess_tokenAndJsapi_ticket/" , function (data) {
                        alert(JSON.stringify(data))
                    })

				})

			} 
			
		);

        // */


        /*
        $(".clear").click(function () {
            $.get("http://www.dangsh.top/clearAccess_tokenAndJsapi_ticket/" , function (data) {
                console.log(data)
            })
        })
        */

	</script>

</html>